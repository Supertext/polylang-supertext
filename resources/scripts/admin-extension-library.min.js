/*!
 * Supertext translation
 * https://wordpress.org/plugins/polylang-supertext/
 * @author Heinrich Muralt
 * @version 2.7.0
 * Copyright 2019 */
var Supertext=Supertext||{};Supertext.Util=void(String.format||(String.format=function(t){var n=Array.prototype.slice.call(arguments,1);return t.replace(/{(\d+)}/g,function(t,e){return void 0!==n[e]?n[e]:t})})),Supertext.Template=function(t,e,n,o){"use strict";var r={orderLinkRow:"sttr-order-link-row",orderProgressBar:"sttr-order-progress-bar",modal:"sttr-modal",modalError:"sttr-modal-error",modalButton:"sttr-modal-button",stepLoader:"sttr-step-loader",contentStep:"sttr-content-step",itemContent:"sttr-item-content",quoteStep:"sttr-quote-step",confirmationStep:"sttr-confirmation-step"},a={},i={initialize:function(){n.each(r,function(t,e){i[t]=function(t){return function(t,e){a.hasOwnProperty(t)||(a[t]=o.template(t));return a[t](e)}(e,t)}})}};return i}(window,document,jQuery,wp),Supertext.Modal=function(t,n,r){"use strict";var a,i={modal:"#sttr-modal",modalBodyContent:"#sttr-modal-body-content",modalFullContent:"#sttr-modal-full-content",modalFullBodyContent:"#sttr-modal-full-body-content",modalNotice:"#sttr-modal-notice",modalCloseIcon:".sttr-modal-icon-close",modalBackground:".sttr-modal-background",modalFooter:".sttr-modal-footer",modalNoticeDismissIcon:".notice-dismiss",modalErrorNotice:function(t){return"#sttr-modal-error-"+t},modalButton:function(t){return"#sttr-modal-button-"+t}},l={noticeCounter:0,buttonCounter:0,closeCallbacks:[],isFullScreenShown:!1};function o(){if(l.isFullScreenShown)return r(i.modalFullContent).hide(),void(l.isFullScreenShown=!1);l.$modal.hide(),l.$modal.remove(),r.each(l.closeCallbacks,function(t,e){e.call()})}function s(t){isNaN(t)?r(i.modalNotice).empty():r(i.modalErrorNotice(t)).remove()}return{initialize:function(t){a=t.template},open:function(t){var e=a.modal(t);r(n.body).append(e),l.$modal=r(i.modal),l.$modal.find(i.modalCloseIcon).click(o),l.$modal.find(i.modalBackground).click(o),l.$modal.show()},close:o,showContent:function(t){r(i.modalBodyContent).html(t)},showFullScreenContent:function(t){r(i.modalFullBodyContent).html(t),r(i.modalFullContent).show(),l.isFullScreenShown=!0},showError:function(t){var e=++l.noticeCounter,n=a.modalError({token:e,error:t});return l.$modal.find(i.modalNotice).append(n),l.$modal.find(i.modalNoticeDismissIcon).click(function(t){t.preventDefault(),s(e)}),e},hideError:s,addButton:function(t,e,n){var o=++l.buttonCounter;return r(i.modalFooter).prepend(a.modalButton({token:o,innerHtml:t,type:e})),r(i.modalButton(o)).click(n),o},removeButton:function(t){r(i.modalButton(t)).remove()},enableButton:function(t){r(i.modalButton(t)).removeClass("button-disabled").prop("disabled",!1)},disableButton:function(t){r(i.modalButton(t)).addClass("button-disabled").prop("disabled",!0)},onClose:function(t){l.closeCallbacks.push(t)}}}(window,document,jQuery),Supertext.Validation=function(o){"use strict";function e(e){return o.Deferred(function(t){var n=[];o.each(e,function(t,e){e(function(t){n.push(t)})}),0<n.length?t.reject(n):t.resolve()}).promise()}return{check:function(t){return e([t])},checkAll:e}}(jQuery),Supertext.Polylang=function(t,e,u){"use strict";var c,d,f,p,m,o="orderTranslation",v={orderItemList:".sttr-order-list",orderItemRemoveIcon:".dashicons-no-alt",orderItemRemoveButton:"#sttr-order-remove-item",orderShowItemContentButton:"#sttr-order-show-item-content",orderStep:"#sttr-order-step",contentStepForm:"#sttr-content-step-form",orderProgressBarSteps:"#sttr-order-progress-bar li",orderSourceLanguageInput:"#sttr-order-source-language",orderSourceLanguageLabel:"#sttr-order-source-language-label",orderTargetLanguageSelect:"#sttr-order-target-language",orderTargetLanguageOptions:"#sttr-order-target-language option",contentCheckboxes:'.sttr-order-item-details input[type="checkbox"]',checkedQuote:'input[name="translationType"]:checked',quoteStepForm:"#sttr-quote-step-form"},n=[],h={currentStepNumber:0};function r(t){return u.extend(new a,new t)}function a(){this.savedStepElements=[],this.validationRules={},this.nextButtonName=m.next}a.prototype={load:function(){return 0<this.savedStepElements.length?this.loadSavedStepElements().done(self.init):this.loadData().done(this.saveData).done(this.addStepElements).done(this.init)},loadSavedStepElements:function(){var e=this;return u.Deferred(function(t){u(v.orderStep).empty(),u(v.orderStep).append(e.savedStepElements),t.resolve()}).promise()},loadData:function(){},saveData:function(t){},addStepElements:function(t){},init:function(){},getNextButtonName:function(){return this.nextButtonName},validate:function(){return p.checkAll(this.validationRules)},save:function(){this.saveForm(),this.savedStepElements=u(v.orderStep).children().detach()},saveForm:function(){}};var i=function(){var t=this;function n(){p.check(t.validationRules.posts).fail(I).done(L).done(s),1==h.posts.length&&u(v.orderItemRemoveButton).hide()}function e(){var t=u(this),e=u(v.orderItemList+" li.active a");0<e.length&&(u(e.attr("href")).hide(),e.parent().removeClass("active")),u(t.attr("href")).show(),t.parent().addClass("active")}function o(t){t.preventDefault(),e.call(this)}function r(t){t.preventDefault(),i.call(u(this).parent())}function a(t){t.preventDefault(),i.call(u(v.orderItemList+" li.active a")),e.call(u(v.orderItemList+" li:first a"))}function i(){if(1!=h.posts.length){var t=u(this);u(t.attr("href")).remove(),t.parent().remove();var e=t.data("post-id");h.posts=h.posts.filter(function(t){return t.id!=e}),n()}}function l(t){t.preventDefault(),function(){var n=u(this).data("post-id");u.when(D(c.ajaxUrl+"?action=sttr_getPostRawData",{postId:n}),F(c.ajaxUrl+"?action=sttr_getPostContentData&postId="+n,u(v.contentStepForm).serializeArray()),u.each(h.posts,function(t,e){return e.id==n?e:null})).done(function(t,e,n){var o=function(t,e){var n=[];for(var o in t.translatableFieldGroups)if(e.hasOwnProperty(o)){for(var r=t.translatableFieldGroups[o].name,a=[],i=[{path:o,value:e[o]}];0<i.length;){var l=i.pop();if("object"==typeof l.value||l.value instanceof Array)for(var s in l.value)i.push({path:l.path+"->"+s,value:l.value[s]});else a.push(l)}n.push({name:r,elements:a})}return n}(n[0],e);d.showFullScreenContent(f.itemContent({rawData:JSON.stringify(t,null,4),contentData:o}))})}.call(u(v.orderItemList+" li.active a"))}function s(){var o=h.posts[0].languageCode;u(v.orderSourceLanguageLabel).html(m.languages[o]),u(v.orderSourceLanguageInput).val(o),u(v.orderTargetLanguageOptions).each(function(t,e){var n=u(e);n.val()!==o?u(e).show():n.remove()})}t.validationRules={posts:function(t){var n=null,o=!0,r=!1;u.each(h.posts,function(t,e){0===t?n=e.languageCode:o=o&&e.languageCode==n,r=r||e.meta.inTranslation}),r&&t(m.errorValidationSomePostInTranslation),o||t(m.errorValidationNotAllPostInSameLanguage)},content:function(t){var n=!1;u(v.contentCheckboxes).each(function(t,e){if(u(e).prop("checked"))return!(n=!0)}),n||t(m.errorValidationSelectContent)},targetLanguage:function(o){if(""!==u(v.orderTargetLanguageSelect).val()){var r=u(v.orderTargetLanguageSelect).val();u.each(h.posts,function(t,e){var n=e.unfinishedTranslations[r];void 0!==n&&o(String.format(m.alreadyBeingTranslatedInto,e.title,m.languages[r],n.orderId))})}else o(m.errorValidationSelectTargetLanguage)}},t.loadData=function(){return D(c.ajaxUrl,{action:"sttr_getPostTranslationInfo",postIds:h.postIds})},t.saveData=function(t){h.posts=t},t.addStepElements=function(){u(v.orderStep).html(f.contentStep({posts:h.posts,targetLanguageCode:h.targetLanguageCode,languages:m.languages}))},t.init=function(){!function(){var t=u(v.orderItemList+" li a");t.click(o),t.find(v.orderItemRemoveIcon).click(r),u(v.orderItemRemoveButton).click(a),u(v.orderShowItemContentButton).click(l),e.call(u(v.orderItemList+" li:first a"))}(),n()},t.saveForm=function(){h.contentFormData=u(v.contentStepForm).serializeArray()}},l=function(){var t=this;t.nextButtonName=m.orderTranslation,t.validationRules={quote:function(t){0===u(v.checkedQuote).length&&t(m.errorValidationSelectQuote)}},t.loadData=function(){return F(c.ajaxUrl+"?action=sttr_getOffer",h.contentFormData)},t.addStepElements=function(t){u(v.orderStep).html(f.quoteStep({wordCount:t.wordCount,language:t.language,options:t.options}))},t.saveForm=function(){h.quoteFormData=u(v.quoteStepForm).serializeArray()}},s=function(){this.loadData=function(){var t=h.contentFormData.concat(h.quoteFormData);return F(c.ajaxUrl+"?action=sttr_getNewPostQueryParams",t).then(function(t){var e,n={};return n[c.newPostAutoSaveFlag]=1,e=u.map(t,function(t){return D(c.newPostUrls[t.fromPost][t.newLang],n)}),u.when.apply(u,e)}).then(function(){return F(c.ajaxUrl+"?action=sttr_createOrder",t)})},this.addStepElements=function(t){u(v.orderStep).html(f.confirmationStep({message:t.message}))}},g=function(){this.loadData=function(){return D(c.ajaxUrl,{action:"sttr_sendSyncRequest",targetPostId:h.targetPostId})},this.addStepElements=function(t){d.showContent(f.confirmationStep({message:t.message}))}};function S(){1==u("#post-translations").length&&k(),c.isCurrentPostInTranslation&&(u("#post input, #post select, #post textarea").each(function(){u(this).attr("readonly","readonly"),u(this).addClass("input-disabled")}),u("#wp-content-wrap").hide())}function k(){u(".pll-translation-column").each(function(){var t=u(this),e=t.find("*[lang]").first().attr("lang"),n=e.substr(0,e.indexOf("-"));t.parent().after(f.orderLinkRow({targetLanguageCode:n}))})}function B(t){var e=u(this).attr("id").substr(2);if(u('select[name="'+e+'"]').val()!==o)return!0;t.preventDefault();var n=[];return u('input[name="post[]"]:checked').each(function(){n.push(u(this).val())}),u('input[name="media[]"]:checked').each(function(){n.push(u(this).val())}),0<n.length?(h.postIds=n,b()):alert(m.alertPleaseSelect),!1}function b(){n=[r(i),r(l),r(s)],x(m.orderModalTitle),d.showContent(f.orderProgressBar({})),h.cancelButtonToken=d.addButton(m.cancel,"secondary",function(){d.close()}),h.backButtonToken=d.addButton(m.back,"secondary",w),y(1)}function x(t){d.open({title:t})}function C(){d.addButton(m.close,"secondary",function(){d.close()}),d.onClose(function(){t.location.reload()})}function T(){n[h.currentStepNumber-1].validate().fail(I).done(L).done(function(){n[h.currentStepNumber-1].save(),y(h.currentStepNumber+1)})}function w(){L(),function(){if(!h.ajaxResponseErrorToken)return;d.hideError(h.ajaxResponseErrorToken),h.ajaxResponseErrorToken=null}(),function(){if(!h.ajaxErrorToken)return;d.hideError(h.ajaxErrorToken),h.ajaxErrorToken=null}(),y(h.currentStepNumber-1)}function y(t){d.disableButton(h.nextButtonToken),d.disableButton(h.backButtonToken),d.disableButton(h.cancelButtonToken),function(n){u(v.orderProgressBarSteps).each(function(t,e){t!=n-1?u(e).removeClass("active"):u(e).addClass("active")})}(t),u(v.orderStep).html(f.stepLoader({})),n[t-1].load().done(function(){E(),function(t){h.nextButtonToken=d.addButton(n[t-1].getNextButtonName(),"primary",T)}(t)}).fail(function(){E()}).always(function(){!function(t){if(t==n.length)return d.removeButton(h.nextButtonToken),d.removeButton(h.backButtonToken),d.removeButton(h.cancelButtonToken),C();t<n.length&&d.enableButton(h.nextButtonToken);1<t&&d.enableButton(h.backButtonToken);d.enableButton(h.cancelButtonToken)}(t)}),h.currentStepNumber=t}function E(){h.nextButtonToken&&d.removeButton(h.nextButtonToken)}function I(t){h.validationErrorToken&&L(),h.validationErrorToken=d.showError({title:m.validationError,message:t})}function L(){h.validationErrorToken&&(d.hideError(h.validationErrorToken),h.validationErrorToken=null)}function D(t,n){return u.Deferred(function(e){u.get(t,n).done(function(t){e.resolve(t)}).fail(N).fail(e.reject)}).promise()}function F(t,n){return u.Deferred(function(e){u.post(t,n).done(function(t){e.resolve(t)}).fail(N).fail(e.reject)}).promise()}function N(t,e,n){h.ajaxErrorToken=d.showError({title:m.networkError,message:t.status+" "+e+": "+n,details:t.responseJSON})}return{initialize:function(t){c=t.context,d=t.modal,f=t.template,p=t.validation,m=t.l10n,c.enable&&("post"==c.screen?S():"edit"!=c.screen&&"upload"!=c.screen||(u("<option>").val(o).text(m.offerTranslation).appendTo("select[name='action']"),u("<option>").val(o).text(m.offerTranslation).appendTo("select[name='action2']"),u("#doaction, #doaction2").click(B)))},openOrderForm:function(t){(function(){var t,e,n=!1,o="undefined"!=typeof tinyMCE&&tinyMCE.activeEditor;o&&!o.isHidden()?o.isDirty()&&(n=!0):(e="undefined"!=typeof fullscreen&&fullscreen.settings.visible?(t=u("#wp-fullscreen-title").val(),u("#wp_mce_fullscreen").val()):(t=u("#post #title").val(),u("#post #content").val()),"undefined"!=typeof autosaveLast&&(t||e)&&t+e!=autosaveLast&&(n=!0));return n})()&&!confirm(m.confirmUnsavedPost)||(h.postIds=[c.currentPostId],h.targetLanguageCode=t,b())},sendSyncRequest:function(){h.targetPostId=c.currentPostId,function(){var t=r(g);x(m.sendChangesModalTitle),C(),d.showContent(f.stepLoader({})),t.load()}()},injectOrderLinks:k}}(window,document,jQuery),jQuery(document).ready(function(){Supertext.Template.initialize(),Supertext.Modal.initialize({template:Supertext.Template}),Supertext.Polylang.initialize({context:Supertext.Context||{enable:!1},modal:Supertext.Modal,template:Supertext.Template,validation:Supertext.Validation,l10n:supertextTranslationL10n})});