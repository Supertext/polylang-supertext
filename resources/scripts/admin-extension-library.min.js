/*!
 * Supertext translation
 * https://wordpress.org/plugins/polylang-supertext/
 * @author Heinrich Muralt
 * @version 2.7.0
 * Copyright 2022 */
var Supertext=Supertext||{};Supertext.Util=void(String.format||(String.format=function(t){var n=Array.prototype.slice.call(arguments,1);return t.replace(/{(\d+)}/g,function(t,e){return void 0!==n[e]?n[e]:t})})),Supertext.Template=function(t,o){"use strict";var e={orderLinkRow:"sttr-order-link-row",orderProgressBar:"sttr-order-progress-bar",modal:"sttr-modal",modalError:"sttr-modal-error",modalButton:"sttr-modal-button",stepLoader:"sttr-step-loader",contentStep:"sttr-content-step",contentStepPr:"sttr-content-step-pr",itemContent:"sttr-item-content",quoteStep:"sttr-quote-step",confirmationStep:"sttr-confirmation-step"},r={},a={initialize:function(){t.each(e,function(t,n){a[t]=function(t){var e=n;return r.hasOwnProperty(e)||(r[e]=o.template(e)),r[e](t)}})}};return a}((window,document,jQuery),wp),Supertext.Modal=function(e,r){"use strict";var a,i={modal:"#sttr-modal",modalBodyContent:"#sttr-modal-body-content",modalFullContent:"#sttr-modal-full-content",modalFullBodyContent:"#sttr-modal-full-body-content",modalNotice:"#sttr-modal-notice",modalCloseIcon:".sttr-modal-icon-close",modalBackground:".sttr-modal-background",modalFooter:".sttr-modal-footer",modalNoticeDismissIcon:".notice-dismiss",modalErrorNotice:function(t){return"#sttr-modal-error-"+t},modalButton:function(t){return"#sttr-modal-button-"+t}},l={noticeCounter:0,buttonCounter:0,closeCallbacks:[],isFullScreenShown:!1};function n(){if(l.isFullScreenShown)return r(i.modalFullContent).hide(),void(l.isFullScreenShown=!1);l.$modal.hide(),l.$modal.remove(),r.each(l.closeCallbacks,function(t,e){e.call()})}function o(t){isNaN(t)?r(i.modalNotice).empty():r(i.modalErrorNotice(t)).remove()}return{initialize:function(t){a=t.template},open:function(t){t=a.modal(t),r(e.body).append(t),l.$modal=r(i.modal),l.$modal.find(i.modalCloseIcon).click(n),l.$modal.find(i.modalBackground).click(n),l.$modal.show()},close:n,showContent:function(t){r(i.modalBodyContent).html(t)},showFullScreenContent:function(t){r(i.modalFullBodyContent).html(t),r(i.modalFullContent).show(),l.isFullScreenShown=!0},showError:function(t){var e=++l.noticeCounter,t=a.modalError({token:e,error:t});return l.$modal.find(i.modalNotice).append(t),l.$modal.find(i.modalNoticeDismissIcon).click(function(t){t.preventDefault(),o(e)}),e},hideError:o,addButton:function(t,e,n){var o=++l.buttonCounter;return r(i.modalFooter).prepend(a.modalButton({token:o,innerHtml:t,type:e})),r(i.modalButton(o)).click(n),o},removeButton:function(t){r(i.modalButton(t)).remove()},enableButton:function(t){r(i.modalButton(t)).removeClass("button-disabled").prop("disabled",!1)},disableButton:function(t){r(i.modalButton(t)).addClass("button-disabled").prop("disabled",!0)},onClose:function(t){l.closeCallbacks.push(t)}}}((window,document),jQuery),Supertext.Validation=function(o){"use strict";function e(e){return o.Deferred(function(t){var n=[];o.each(e,function(t,e){e(function(t){n.push(t)})}),0<n.length?t.reject(n):t.resolve()}).promise()}return{check:function(t){return e([t])},checkAll:e}}(jQuery),Supertext.Interface=function(t,c){"use strict";var d,p,f,m,h,o="orderTranslation",r="orderProofread",g={orderItemList:".sttr-order-list",orderItemRemoveIcon:".dashicons-no-alt",orderItemRemoveButton:"#sttr-order-remove-item",orderShowItemContentButton:"#sttr-order-show-item-content",orderStep:"#sttr-order-step",contentStepForm:"#sttr-content-step-form",orderProgressBarSteps:"#sttr-order-progress-bar li",orderSourceLanguageInput:"#sttr-order-source-language",orderSourceLanguageLabel:"#sttr-order-source-language-label",orderTargetLanguageSelect:"#sttr-order-target-language",orderTargetLanguageOptions:"#sttr-order-target-language option",contentCheckboxes:'.sttr-order-item-details input[type="checkbox"]',postContentCheckbox:function(t,e,n){return"#sttr-"+t+"-"+e+"-"+n},checkedQuote:'input[name="translationType"]:checked',quoteStepForm:"#sttr-quote-step-form"},a=[],v={currentStepNumber:0},S=!1;function e(t){return c.extend(new n,new t)}function n(){this.savedStepElements=[],this.validationRules={},this.nextButtonName=h.next}n.prototype={load:function(){return 0<this.savedStepElements.length?this.loadSavedStepElements().done(self.init):this.loadData().done(this.saveData).done(this.addStepElements).done(this.init)},loadSavedStepElements:function(){var e=this;return c.Deferred(function(t){c(g.orderStep).empty(),c(g.orderStep).append(e.savedStepElements),t.resolve()}).promise()},loadData:function(){},saveData:function(t){},addStepElements:function(t){},init:function(){},getNextButtonName:function(){return this.nextButtonName},validate:function(){return m.checkAll(this.validationRules)},save:function(){this.saveForm(),this.savedStepElements=c(g.orderStep).children().detach()},saveForm:function(){}};function i(){var t=this;function n(){m.check(t.validationRules.posts).fail(F).done(D).done(u),1==v.posts.length&&c(g.orderItemRemoveButton).hide()}function s(n,t,o,r){c.each(t,function(t,e){t=g.postContentCheckbox(n,t,e);o?(c(t).prop("checked",!0),c(t).click(function(t){return t.preventDefault(),!1}),c(t).prop("title",r)):(c(t).prop("disabled",!1),c(t).off("click"),c(t).prop("title",""))})}function e(){var t=c(this),e=c(g.orderItemList+" li.active a");0<e.length&&(c(e.attr("href")).hide(),e.parent().removeClass("active")),c(t.attr("href")).show(),t.parent().addClass("active")}function o(t){t.preventDefault(),e.call(this)}function r(t){t.preventDefault(),i.call(c(this).parent())}function a(t){t.preventDefault(),i.call(c(g.orderItemList+" li.active a")),e.call(c(g.orderItemList+" li:first a"))}function i(){var t,e;1!=v.posts.length&&(t=c(this),c(t.attr("href")).remove(),t.parent().remove(),e=t.data("post-id"),v.posts=v.posts.filter(function(t){return t.id!=e}),n())}function l(t){t.preventDefault(),function(){var n=c(this).data("post-id");c.when(N(d.ajaxUrl+"?action=sttr_getPostRawData",{postId:n}),j(d.ajaxUrl+"?action=sttr_getPostContentData&postId="+n,c(g.contentStepForm).serializeArray()),c.each(v.posts,function(t,e){return e.id==n?e:null})).done(function(t,e,n){n=function(t,e){var n,o=[];for(n in t.translatableFieldGroups)if(e.hasOwnProperty(n)){for(var r=t.translatableFieldGroups[n].name,a=[],i=[{path:n,value:e[n]}];0<i.length;){var l=i.pop();if("object"==typeof l.value||l.value instanceof Array)for(var s in l.value)i.push({path:l.path+"->"+s,value:l.value[s]});else a.push(l)}o.push({name:r,elements:a})}return o}(n[0],e);p.showFullScreenContent(f.itemContent({rawData:JSON.stringify(t,null,4),contentData:n}))})}.call(c(g.orderItemList+" li.active a"))}function u(){var o=v.posts[0].languageCode;c(g.orderSourceLanguageLabel).html(h.languages[o]),c(g.orderSourceLanguageInput).val(o),S?c(g.orderTargetLanguageSelect).val(o):c(g.orderTargetLanguageOptions).each(function(t,e){var n=c(e);n.val()===o?n.remove():c(e).show()})}t.validationRules={posts:function(t){var n=null,o=!0,r=!1,a=!1;S?(c.each(v.posts,function(t,e){0===t?n=e.languageCode:o=o&&e.languageCode==n,a=a||e.meta.inProofreading}),a&&t(h.errorValidationSomePostInProofreading)):(c.each(v.posts,function(t,e){0===t?n=e.languageCode:o=o&&e.languageCode==n,r=r||e.meta.inTranslation}),r&&t(h.errorValidationSomePostInTranslation),o||t(h.errorValidationNotAllPostInSameLanguage))},content:function(t){var n=!1;c(g.contentCheckboxes).each(function(t,e){if(c(e).prop("checked"))return!(n=!0)}),n||t(S?h.errorValidationSelectContentPr:h.errorValidationSelectContent)},targetLanguage:function(o){var r;S||(""===c(g.orderTargetLanguageSelect).val()?o(h.errorValidationSelectTargetLanguage):(r=c(g.orderTargetLanguageSelect).val(),c.each(v.posts,function(t,e){var n=e.unfinishedTranslations[r];void 0!==n&&o(String.format(h.alreadyBeingTranslatedInto,e.title,h.languages[r],n.orderId))})))}},t.loadData=function(){return N(d.ajaxUrl,{action:"sttr_getPostTranslationInfo",postIds:v.postIds})},t.saveData=function(t){v.posts=t},t.addStepElements=function(){var t=f.contentStep;S&&(t=f.contentStepPr),c(g.orderStep).html(t({posts:v.posts,targetLanguageCode:v.targetLanguageCode,languages:h.languages}))},t.init=function(){var t;(t=c(g.orderItemList+" li a")).click(o),t.find(g.orderItemRemoveIcon).click(r),c(g.orderItemRemoveButton).click(a),c(g.orderShowItemContentButton).click(l),e.call(c(g.orderItemList+" li:first a")),n(),c.each(v.posts,function(t,e){var l=e.id;c.each(e.translatableFieldGroups,function(a,i){c.each(i.fields,function(t,e){if(void 0!==e.dependencies){var n=String.format(h.fieldDependentOn,i.name+" -> "+e.title),o=g.postContentCheckbox(l,a,e.name);const r=c(o);r.change(function(t){s(l,e.dependencies,t.target.checked,n)}),s(l,e.dependencies,r.prop("checked"),n)}})})})},t.saveForm=function(){v.contentFormData=c(g.contentStepForm).serializeArray()}}function l(){var t=this;t.nextButtonName=S?h.orderProofreading:h.orderTranslation,t.validationRules={quote:function(t){0===c(g.checkedQuote).length&&t(h.errorValidationSelectQuote)}},t.loadData=function(){return j(d.ajaxUrl+"?action=sttr_getOffer",v.contentFormData)},t.addStepElements=function(t){c(g.orderStep).html(f.quoteStep({wordCount:t.wordCount,language:t.language,options:t.options,isProofreading:S}))},t.saveForm=function(){v.quoteFormData=c(g.quoteStepForm).serializeArray()}}function s(){this.loadData=function(){var t=v.contentFormData.concat(v.quoteFormData);return S?j(d.ajaxUrl+"?action=sttr_createOrder",t):j(d.ajaxUrl+"?action=sttr_getNewPostQueryParams",t).then(function(t){t=c.map(t,function(t){var e={};return e[d.newPostAutoSaveFlag]=1,e.source_post=t.fromPost,e.target_lang=t.newLang,N(d.newPostUrls[t.fromPost][t.newLang],e)});return c.when.apply(c,t)}).then(function(){return j(d.ajaxUrl+"?action=sttr_createOrder",t)})},this.addStepElements=function(t){c(g.orderStep).html(f.confirmationStep({message:t.message}))}}var u=function(){this.loadData=function(){return N(d.ajaxUrl,{action:"sttr_sendSyncRequest",targetPostId:v.targetPostId})},this.addStepElements=function(t){p.showContent(f.confirmationStep({message:t.message}))}};function k(){1!=c("#post-translations").length&&1!=c("#icl_div").length||C(),d.isCurrentPostInTranslation&&(c("#post input, #post select, #post textarea").each(function(){c(this).attr("readonly","readonly"),c(this).addClass("input-disabled")}),c("#wp-content-wrap").hide())}function C(){c(".pll-translation-column").each(function(){var t=c(this),e=t.find("*[lang]").first().attr("lang"),e=e.substr(0,e.indexOf("-"));t.parent().after(f.orderLinkRow({targetLanguageCode:e}))}),c("#icl_untranslated_table tr").each(function(){var t,e=c(this);e.is("tr:first-child")||e.is("tr:last-child")||0==e.text().trim().length||(t=e.find('input[name="icl_dupes[]"]').attr("value"),e.after(f.orderLinkRow({targetLanguageCode:t})))})}function x(t){t&&(c("<option>").val(o).text(h.offerTranslation).appendTo("select[name='action']"),c("<option>").val(o).text(h.offerTranslation).appendTo("select[name='action2']")),c("<option>").val(r).text(h.offerProofread).appendTo("select[name='action']"),c("<option>").val(r).text(h.offerProofread).appendTo("select[name='action2']"),c("#doaction, #doaction2").click(B)}function B(t){var e=c(this).attr("id").substr(2),e=c('select[name="'+e+'"]').val();if(e!==r&&e!==o)return!0;t.preventDefault();var n=[];return c('input[name="post[]"]:checked').each(function(){n.push(c(this).val())}),c('input[name="media[]"]:checked').each(function(){n.push(c(this).val())}),0===n.length?alert(h.alertPleaseSelect):e===o?b(n):e===r&&T(n),!1}function b(t){S=!1,g.contentStepForm="#sttr-content-step-form",v.postIds=t,w()}function T(t){S=!0,g.contentStepForm="#sttr-content-step-form-pr",v.postIds=t,w()}function w(){a=[e(i),e(l),e(s)],y(S?h.orderModalTitlePr:h.orderModalTitle),p.showContent(f.orderProgressBar({})),v.cancelButtonToken=p.addButton(h.cancel,"secondary",function(){p.close()}),v.backButtonToken=p.addButton(h.back,"secondary",_),P(1)}function y(t){p.open({title:t})}function I(){p.addButton(h.close,"secondary",function(){p.close()}),p.onClose(function(){t.location.reload()})}function E(){a[v.currentStepNumber-1].validate().fail(F).done(D).done(function(){a[v.currentStepNumber-1].save(),P(v.currentStepNumber+1)})}function _(){D(),v.ajaxResponseErrorToken&&(p.hideError(v.ajaxResponseErrorToken),v.ajaxResponseErrorToken=null),v.ajaxErrorToken&&(p.hideError(v.ajaxErrorToken),v.ajaxErrorToken=null),P(v.currentStepNumber-1)}function P(e){var n;p.disableButton(v.nextButtonToken),p.disableButton(v.backButtonToken),p.disableButton(v.cancelButtonToken),n=e,c(g.orderProgressBarSteps).each(function(t,e){t==n-1?c(e).addClass("active"):c(e).removeClass("active")}),c(g.orderStep).html(f.stepLoader({})),a[e-1].load().done(function(){L(),v.nextButtonToken=p.addButton(a[e-1].getNextButtonName(),"primary",E)}).fail(function(){L()}).always(function(){var t;(t=e)==a.length?(p.removeButton(v.nextButtonToken),p.removeButton(v.backButtonToken),p.removeButton(v.cancelButtonToken),I()):(t<a.length&&p.enableButton(v.nextButtonToken),1<t&&p.enableButton(v.backButtonToken),p.enableButton(v.cancelButtonToken))}),v.currentStepNumber=e}function L(){v.nextButtonToken&&p.removeButton(v.nextButtonToken)}function F(t){v.validationErrorToken&&D(),v.validationErrorToken=p.showError({title:h.validationError,message:t})}function D(){v.validationErrorToken&&(p.hideError(v.validationErrorToken),v.validationErrorToken=null)}function N(t,n){return c.Deferred(function(e){c.get(t,n).done(function(t){e.resolve(t)}).fail(R).fail(e.reject)}).promise()}function j(t,n){return c.Deferred(function(e){c.post(t,n).done(function(t){e.resolve(t)}).fail(R).fail(e.reject)}).promise()}function R(t,e,n){v.ajaxErrorToken=p.showError({title:h.networkError,message:t.status+" "+e+": "+n,details:t.responseJSON})}return{initialize:function(t){d=t.context,p=t.modal,f=t.template,m=t.validation,h=t.l10n,d.enable&&("post"==d.screen?k():"edit"!=d.screen&&"upload"!=d.screen||x(d.isMultilangReady))},openOrderForm:function(t,e){(!function(){var t,e=!1,n="undefined"!=typeof tinyMCE&&tinyMCE.activeEditor;n&&!n.isHidden()?n.isDirty()&&(e=!0):(n="undefined"!=typeof fullscreen&&fullscreen.settings.visible?(t=c("#wp-fullscreen-title").val(),c("#wp_mce_fullscreen").val()):(t=c("#post #title").val(),c("#post #content").val()),"undefined"!=typeof autosaveLast&&(t||n)&&t+n!=autosaveLast&&(e=!0));return e}()||confirm(h.confirmUnsavedPost))&&(v.targetLanguageCode=t,(e?T:b)([d.currentPostId]))},startTranslationOrderProcess:b,startProofreadOrderProcess:T,sendSyncRequest:function(){var t;v.targetPostId=d.currentPostId,t=e(u),y(h.sendChangesModalTitle),I(),p.showContent(f.stepLoader({})),t.load()},injectOrderLinks:C}}(window,(document,jQuery)),jQuery(document).ready(function(){Supertext.Template.initialize(),Supertext.Modal.initialize({template:Supertext.Template}),Supertext.Interface.initialize({context:Supertext.Context||{enable:!1},modal:Supertext.Modal,template:Supertext.Template,validation:Supertext.Validation,l10n:supertextTranslationL10n})});